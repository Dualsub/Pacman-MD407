/*
 * 	startup.c
 *
 */
 
 #include "graphics.h"
 #include "delay.h"
 #include "keypad.h"
 #include "object.h"
 #include "pacman.h"
 #include "ghost.h"
 
__attribute__((naked)) __attribute__((section (".start_section")) )
void startup ( void )
{
__asm__ volatile(" LDR R0,=0x2001C000\n");		/* set stack */
__asm__ volatile(" MOV SP,R0\n");
__asm__ volatile(" BL main\n");					/* call main */
__asm__ volatile(".L1: B .L1\n");				/* never return */
}

#define NUM_WALLS 56

void main(void)
{
    graphics_init();
    keypad_init();
    
    ascii_display("       PACMAN", 1);
    ascii_display("  AV SIMON O FILIP ", 2);
    
	GEOMERTY pacman_sprite = { 
	16, 
	5, 5,
	{{2,0}, {3,0}, {4,0}, {1,1}, {5,1}, {0,2}, {0,3}, {0,4}, {6,2}, {6,3}, {6,4}, {1,5}, {5,5}, {2,6}, {3,6}, {4,6}}
	};
	
    GEOMERTY ghost_sprite = {
    24,
    5,5,
    {
    {2,0},{3,0},{4,0},{1,1},{5,1},{0,2},{0,3},{0,4},{0,5},{0,6},{6,2},{6,3},{6,4},{6,5},{6,6},{1,5},{2,5},{3,5},{4,5},{5,5},{2,6},{4,6},{2,3},{4,3}
    }
    };

	OBJECT ghost = { 
	&ghost_sprite, 
	{
    {2,0},{3,0},{4,0},{1,1},{5,1},{0,2},{0,3},{0,4},{0,5},{0,6},{6,2},{6,3},{6,4},{6,5},{6,6},{1,5},{2,5},{3,5},{4,5},{5,5},{2,6},{4,6},{2,3},{4,3}
    },
	1, 0,
	56, 28,
	ghost_draw,
	clear_object,
	ghost_move,
	set_object_speed
	};
	
	OBJECT ghost2 = { 
	&ghost_sprite, 
	{
    {2,0},{3,0},{4,0},{1,1},{5,1},{0,2},{0,3},{0,4},{0,5},{0,6},{6,2},{6,3},{6,4},{6,5},{6,6},{1,5},{2,5},{3,5},{4,5},{5,5},{2,6},{4,6},{2,3},{4,3}
    },
	1, 0,
	42, 1,
	ghost_draw,
	clear_object,
	ghost_move,
	set_object_speed
	};
	
	OBJECT pacman = { 
		&pacman_sprite, 
		{{2,0}, {3,0}, {4,0}, {1,1}, {5,1}, {0,2}, {0,3}, {0,4}, {6,2}, {6,3}, {6,4}, {1,5}, {5,5}, {2,6}, {3,6}, {4,6}},
		0, 0,
		56, 28,
		pacman_draw,
		clear_object,
		pacman_move,
		set_object_speed
		};
    
	POINT level[NUM_WALLS] = {
/*		{2,2},
		{2,3},
		{2,4},
		{2,5}
*/	{4,0},
	{13,0},
	{1,1},
	{2,1},
	{4,1},
	{6,1},
	{7,1},
	{8,1},
	{9,1},
	{10,1},
	{11,1},
	{13,1},
	{15,1},
	{16,1},
	{1,2},
	{16,2},
	{1,3},
	{3,3},
	{4,3},
	{6,3},
	{7,3},
	{10,3},
	{11,3},
	{13,3},
	{14,3},
	{16,3},
	{6,4},
	{11,4},
	{1,5},
	{3,5},
	{4,5},
	{6,5},
	{7,5},
	{8,5},
	{9,5},
	{10,5},
	{11,5},
	{13,5},
	{14,5},
	{16,5},
	{1,6},
	{16,6},
	{1,7},
	{2,7},
	{4,7},
	{6,7},
	{7,7},
	{8,7},
	{9,7},
	{10,7},
	{11,7},
	{13,7},
	{15,7},
	{16,7},
	{4,8},
	{13,8}
};
	
	POINT map_sprite[678] = 
	{
	{30,2},
	{31,2},
	{32,2},
	{93,2},
	{94,2},
	{95,2},
	{29,3},
	{33,3},
	{92,3},
	{96,3},
	{29,4},
	{33,4},
	{92,4},
	{96,4},
	{29,5},
	{33,5},
	{92,5},
	{96,5},
	{29,6},
	{33,6},
	{92,6},
	{96,6},
	{29,7},
	{33,7},
	{92,7},
	{96,7},
	{10,8},
	{11,8},
	{12,8},
	{13,8},
	{14,8},
	{15,8},
	{16,8},
	{17,8},
	{29,8},
	{33,8},
	{45,8},
	{46,8},
	{47,8},
	{48,8},
	{49,8},
	{50,8},
	{51,8},
	{52,8},
	{53,8},
	{54,8},
	{55,8},
	{56,8},
	{57,8},
	{58,8},
	{59,8},
	{60,8},
	{61,8},
	{62,8},
	{63,8},
	{64,8},
	{65,8},
	{66,8},
	{67,8},
	{68,8},
	{69,8},
	{70,8},
	{71,8},
	{72,8},
	{73,8},
	{74,8},
	{75,8},
	{76,8},
	{77,8},
	{78,8},
	{79,8},
	{80,8},
	{92,8},
	{96,8},
	{108,8},
	{109,8},
	{110,8},
	{111,8},
	{112,8},
	{113,8},
	{114,8},
	{115,8},
	{9,9},
	{18,9},
	{29,9},
	{33,9},
	{44,9},
	{81,9},
	{92,9},
	{96,9},
	{107,9},
	{116,9},
	{8,10},
	{18,10},
	{29,10},
	{33,10},
	{44,10},
	{81,10},
	{92,10},
	{96,10},
	{107,10},
	{117,10},
	{8,11},
	{18,11},
	{30,11},
	{31,11},
	{32,11},
	{44,11},
	{81,11},
	{93,11},
	{94,11},
	{95,11},
	{107,11},
	{117,11},
	{8,12},
	{12,12},
	{13,12},
	{14,12},
	{15,12},
	{16,12},
	{17,12},
	{45,12},
	{46,12},
	{47,12},
	{48,12},
	{49,12},
	{50,12},
	{51,12},
	{52,12},
	{53,12},
	{54,12},
	{55,12},
	{56,12},
	{57,12},
	{58,12},
	{59,12},
	{60,12},
	{61,12},
	{62,12},
	{63,12},
	{64,12},
	{65,12},
	{66,12},
	{67,12},
	{68,12},
	{69,12},
	{70,12},
	{71,12},
	{72,12},
	{73,12},
	{74,12},
	{75,12},
	{76,12},
	{77,12},
	{78,12},
	{79,12},
	{80,12},
	{108,12},
	{109,12},
	{110,12},
	{111,12},
	{112,12},
	{113,12},
	{117,12},
	{8,13},
	{12,13},
	{113,13},
	{117,13},
	{8,14},
	{12,14},
	{113,14},
	{117,14},
	{8,15},
	{12,15},
	{113,15},
	{117,15},
	{8,16},
	{12,16},
	{113,16},
	{117,16},
	{8,17},
	{12,17},
	{113,17},
	{117,17},
	{8,18},
	{12,18},
	{113,18},
	{117,18},
	{8,19},
	{12,19},
	{113,19},
	{117,19},
	{8,20},
	{12,20},
	{113,20},
	{117,20},
	{8,21},
	{12,21},
	{113,21},
	{117,21},
	{8,22},
	{12,22},
	{24,22},
	{25,22},
	{26,22},
	{27,22},
	{28,22},
	{29,22},
	{30,22},
	{31,22},
	{45,22},
	{46,22},
	{47,22},
	{48,22},
	{49,22},
	{50,22},
	{51,22},
	{52,22},
	{73,22},
	{74,22},
	{75,22},
	{76,22},
	{77,22},
	{78,22},
	{79,22},
	{80,22},
	{94,22},
	{95,22},
	{96,22},
	{97,22},
	{98,22},
	{99,22},
	{100,22},
	{101,22},
	{113,22},
	{117,22},
	{8,23},
	{12,23},
	{23,23},
	{32,23},
	{44,23},
	{53,23},
	{72,23},
	{81,23},
	{93,23},
	{102,23},
	{113,23},
	{117,23},
	{8,24},
	{12,24},
	{23,24},
	{32,24},
	{43,24},
	{53,24},
	{72,24},
	{82,24},
	{93,24},
	{102,24},
	{113,24},
	{117,24},
	{9,25},
	{10,25},
	{11,25},
	{23,25},
	{32,25},
	{43,25},
	{53,25},
	{72,25},
	{82,25},
	{93,25},
	{102,25},
	{114,25},
	{115,25},
	{116,25},
	{24,26},
	{25,26},
	{26,26},
	{27,26},
	{28,26},
	{29,26},
	{30,26},
	{31,26},
	{43,26},
	{47,26},
	{48,26},
	{49,26},
	{50,26},
	{51,26},
	{52,26},
	{73,26},
	{74,26},
	{75,26},
	{76,26},
	{77,26},
	{78,26},
	{82,26},
	{94,26},
	{95,26},
	{96,26},
	{97,26},
	{98,26},
	{99,26},
	{100,26},
	{101,26},
	{43,27},
	{47,27},
	{78,27},
	{82,27},
	{43,28},
	{47,28},
	{78,28},
	{82,28},
	{43,29},
	{47,29},
	{78,29},
	{82,29},
	{43,30},
	{47,30},
	{78,30},
	{82,30},
	{43,31},
	{47,31},
	{78,31},
	{82,31},
	{43,32},
	{47,32},
	{78,32},
	{82,32},
	{43,33},
	{47,33},
	{78,33},
	{82,33},
	{43,34},
	{47,34},
	{78,34},
	{82,34},
	{43,35},
	{47,35},
	{78,35},
	{82,35},
	{24,36},
	{25,36},
	{26,36},
	{27,36},
	{28,36},
	{29,36},
	{30,36},
	{31,36},
	{43,36},
	{47,36},
	{48,36},
	{49,36},
	{50,36},
	{51,36},
	{52,36},
	{53,36},
	{54,36},
	{55,36},
	{56,36},
	{57,36},
	{58,36},
	{59,36},
	{60,36},
	{61,36},
	{62,36},
	{63,36},
	{64,36},
	{65,36},
	{66,36},
	{67,36},
	{68,36},
	{69,36},
	{70,36},
	{71,36},
	{72,36},
	{73,36},
	{74,36},
	{75,36},
	{76,36},
	{77,36},
	{78,36},
	{82,36},
	{94,36},
	{95,36},
	{96,36},
	{97,36},
	{98,36},
	{99,36},
	{100,36},
	{101,36},
	{9,37},
	{10,37},
	{11,37},
	{23,37},
	{32,37},
	{43,37},
	{82,37},
	{93,37},
	{102,37},
	{114,37},
	{115,37},
	{116,37},
	{8,38},
	{12,38},
	{23,38},
	{32,38},
	{43,38},
	{82,38},
	{93,38},
	{102,38},
	{113,38},
	{117,38},
	{8,39},
	{12,39},
	{23,39},
	{32,39},
	{44,39},
	{81,39},
	{93,39},
	{102,39},
	{113,39},
	{117,39},
	{8,40},
	{12,40},
	{24,40},
	{25,40},
	{26,40},
	{27,40},
	{28,40},
	{29,40},
	{30,40},
	{31,40},
	{45,40},
	{46,40},
	{47,40},
	{48,40},
	{49,40},
	{50,40},
	{51,40},
	{52,40},
	{53,40},
	{54,40},
	{55,40},
	{56,40},
	{57,40},
	{58,40},
	{59,40},
	{60,40},
	{61,40},
	{62,40},
	{63,40},
	{64,40},
	{65,40},
	{66,40},
	{67,40},
	{68,40},
	{69,40},
	{70,40},
	{71,40},
	{72,40},
	{73,40},
	{74,40},
	{75,40},
	{76,40},
	{77,40},
	{78,40},
	{79,40},
	{80,40},
	{94,40},
	{95,40},
	{96,40},
	{97,40},
	{98,40},
	{99,40},
	{100,40},
	{101,40},
	{113,40},
	{117,40},
	{8,41},
	{12,41},
	{113,41},
	{117,41},
	{8,42},
	{12,42},
	{113,42},
	{117,42},
	{8,43},
	{12,43},
	{113,43},
	{117,43},
	{8,44},
	{12,44},
	{113,44},
	{117,44},
	{8,45},
	{12,45},
	{113,45},
	{117,45},
	{8,46},
	{12,46},
	{113,46},
	{117,46},
	{8,47},
	{12,47},
	{113,47},
	{117,47},
	{8,48},
	{12,48},
	{113,48},
	{117,48},
	{8,49},
	{12,49},
	{113,49},
	{117,49},
	{8,50},
	{12,50},
	{13,50},
	{14,50},
	{15,50},
	{16,50},
	{17,50},
	{45,50},
	{46,50},
	{47,50},
	{48,50},
	{49,50},
	{50,50},
	{51,50},
	{52,50},
	{53,50},
	{54,50},
	{55,50},
	{56,50},
	{57,50},
	{58,50},
	{59,50},
	{60,50},
	{61,50},
	{62,50},
	{63,50},
	{64,50},
	{65,50},
	{66,50},
	{67,50},
	{68,50},
	{69,50},
	{70,50},
	{71,50},
	{72,50},
	{73,50},
	{74,50},
	{75,50},
	{76,50},
	{77,50},
	{78,50},
	{79,50},
	{80,50},
	{108,50},
	{109,50},
	{110,50},
	{111,50},
	{112,50},
	{113,50},
	{117,50},
	{8,51},
	{18,51},
	{30,51},
	{31,51},
	{32,51},
	{44,51},
	{81,51},
	{93,51},
	{94,51},
	{95,51},
	{107,51},
	{117,51},
	{8,52},
	{18,52},
	{29,52},
	{33,52},
	{44,52},
	{81,52},
	{92,52},
	{96,52},
	{107,52},
	{117,52},
	{9,53},
	{18,53},
	{29,53},
	{33,53},
	{44,53},
	{81,53},
	{92,53},
	{96,53},
	{107,53},
	{116,53},
	{10,54},
	{11,54},
	{12,54},
	{13,54},
	{14,54},
	{15,54},
	{16,54},
	{17,54},
	{29,54},
	{33,54},
	{45,54},
	{46,54},
	{47,54},
	{48,54},
	{49,54},
	{50,54},
	{51,54},
	{52,54},
	{53,54},
	{54,54},
	{55,54},
	{56,54},
	{57,54},
	{58,54},
	{59,54},
	{60,54},
	{61,54},
	{62,54},
	{63,54},
	{64,54},
	{65,54},
	{66,54},
	{67,54},
	{68,54},
	{69,54},
	{70,54},
	{71,54},
	{72,54},
	{73,54},
	{74,54},
	{75,54},
	{76,54},
	{77,54},
	{78,54},
	{79,54},
	{80,54},
	{92,54},
	{96,54},
	{108,54},
	{109,54},
	{110,54},
	{111,54},
	{112,54},
	{113,54},
	{114,54},
	{115,54},
	{29,55},
	{33,55},
	{92,55},
	{96,55},
	{29,56},
	{33,56},
	{92,56},
	{96,56},
	{29,57},
	{33,57},
	{92,57},
	{96,57},
	{29,58},
	{33,58},
	{92,58},
	{96,58},
	{29,59},
	{33,59},
	{92,59},
	{96,59},
	{30,60},
	{31,60},
	{32,60},
	{93,60},
	{94,60},
	{95,60}
	};
	
	for(int i = 0; i < 678; i++)
	{
		graphics_pixel_set(map_sprite[i].x, map_sprite[i].y);
	}
	
	pacman_draw(&pacman);
	
	while(1)
	{
        ghost_move(&ghost, level, NUM_WALLS);
		ghost_move(&ghost2, level, NUM_WALLS);
		pacman_move(&pacman, level, NUM_WALLS);
        if (ghost_pacman_collide(&pacman, &ghost) || ghost_pacman_collide(&pacman, &ghost2))
            // Skriver game over.
            delay_mikro(100);
            graphics_clear_screen();
            break;
	}
	
	
}

